<template>
    <div class="picview">
        <!-- <img @click="picsee(src=imgdata)" :src="imgdata" alt="" :style="`width:${width};height:${height}`"> -->

        <div @click="close($event)" ref="pop" class="picview-pop">

            <i ref="rote" class="roteA" @click="roteA">
                <Tooltip placement="top" content="逆时针旋转">
                <div style="transform: scale(-1,1);"> 
                <svg class="icon" style="width: 40px; height: 40px;vertical-align: middle;fill: #ff9900;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1408">
                    <path d="M951.629227 461.298248c-11.243065-11.478426-31.018457-11.573593-42.421158-0.393973l-19.681248 19.352767C879.102401 259.036661 699.342294 86.802972 477.064838 86.802972c-227.913826 0-413.357376 185.43127-413.357376 413.357376 0 227.943502 185.445596 413.373749 413.357376 413.373749 121.468492 0 236.415454-53.759391 314.960345-146.978493 3.494591-2.674922 6.330172-5.887081 8.469905-9.510608 0.283456-0.343831 0.599657-0.693802 0.913812-1.038656l2.016937-3.181459-0.661056-0.343831c1.353834-3.560082 1.984191-7.02602 1.984191-10.518564 0-17.229406-13.983479-31.240515-31.209816-31.240515-10.361999 0-20.060895 5.509481-25.698289 14.424524-67.300802 80.872912-165.997662 127.260405-270.775007 127.260405-194.21533 0-352.277252-158.031223-352.277252-352.24553 0-194.19998 158.060899-352.261902 352.277252-352.261902 192.954617 0 350.169241 155.936515 352.21483 348.388688l-35.052331-35.144428c-11.307533-11.385305-31.113625-11.417027-42.420135-0.096191-11.778254 11.701506-11.778254 30.753421-0.063445 42.48358l74.008574 74.194816c5.637394 5.701862 13.227256 8.818853 21.22644 8.818853l0.314155-0.029676 0.787946 0.218988c1.699712 0.441045 3.559059 0.944512 5.636371 0.944512 7.874341 0 15.337313-3.052522 21.00643-8.594749l76.558653-75.331709c5.732561-5.622044 8.943696-13.211906 9.008164-21.227464C960.351889 474.525504 957.266621 466.999087 951.629227 461.298248M675.059238 606.886067l-0.030699-0.124843 0.063445-234.57248c0-28.42233-23.147186-51.537793-51.554166-51.537793L311.508221 320.650951c-28.405957 0-51.522444 23.115464-51.522444 51.537793l0 268.680299c0 28.405957 23.116487 51.55212 51.522444 51.55212l312.030619 0c28.405957 0 51.554166-23.14514 51.554166-51.55212l-0.030699-32.500205 0-1.482771L675.059238 606.886067zM629.458667 374.252753l0 234.209206 0 15.150048 0 15.210423c0 4.408403-3.590781 7.997138-7.999185 7.997138L313.585533 646.819568c-4.408403 0-7.999185-3.589758-7.999185-7.997138L305.586348 374.252753c0-4.425799 3.590781-7.999185 7.999185-7.999185l307.872926 0C625.867886 366.253568 629.458667 369.826953 629.458667 374.252753M586.060251 439.742303c-6.455015 0-12.501732 2.487657-17.006326 6.974855l-83.424015 92.77908L430.235276 500.19207c-4.345981-4.077875-10.077519-6.26775-16.156982-6.26775-7.904017 0-13.951757 2.551102-18.581194 7.212262l-64.623833 86.414115c-8.345062 8.251941-8.345062 23.36822 0.913812 32.659841 4.535293 4.53427 10.519588 7.020904 16.848737 7.020904 6.487761 0 12.43931-2.548032 17.195637-7.336082l52.465932-70.101591L472.686111 588.339666c4.408403 4.122901 10.235109 6.329149 16.818037 6.329149 6.457062 0 12.472056-2.521426 17.005302-7.083326l96.746438-107.59553c4.15667-4.094248 6.643304-10.093892 6.643304-16.502859 0-6.392594-2.488681-12.392238-7.054673-16.895809C598.53333 442.261683 592.391447 439.742303 586.060251 439.742303M402.521075 487.689315c25.446555 0 46.168506-20.707624 46.168506-46.184879 0-25.446555-20.721951-46.153156-46.168506-46.153156-25.445532 0-46.167482 20.705578-46.167482 46.153156C356.353592 466.98169 377.075543 487.689315 402.521075 487.689315" p-id="1409"></path>
                </svg>
                </div>
                </Tooltip>
            </i>
            <i ref="rote" class="mid" @click="closePic">
                <Tooltip placement="top" content="关闭">
                    <svg class="icon" style="width: 40px; height: 40px;vertical-align: middle;fill: #ff9900;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1408">
                    <path d="M933.60766 955.85804 812.270296 955.85804c-11.178032 0-20.222382-9.083889-20.222382-20.221554 0-11.178597 9.044351-20.222577 20.222382-20.222577l101.113958 0 0-101.109816c0-11.177574 9.045374-20.221554 20.223406-20.221554 11.138121 0 20.222382 9.04398 20.222382 20.221554l0 121.331369C953.829019 946.774151 944.744758 955.85804 933.60766 955.85804zM933.60766 713.195302c-11.178032 0-20.223406-9.084912-20.223406-20.222577L913.384254 571.642378c0-11.177574 9.045374-20.222577 20.223406-20.222577 11.138121 0 20.222382 9.045003 20.222382 20.222577L953.830042 692.972724C953.829019 704.110389 944.744758 713.195302 933.60766 713.195302zM933.60766 470.532563c-11.178032 0-20.223406-9.083889-20.223406-20.221554L913.384254 328.97964c0-11.17655 9.045374-20.221554 20.223406-20.221554 11.138121 0 20.222382 9.045003 20.222382 20.221554l0 121.331369C953.829019 461.448674 944.744758 470.532563 933.60766 470.532563zM933.60766 227.870848c-11.178032 0-20.223406-9.083889-20.223406-20.222577l0-101.108792-101.113958 0c-11.178032 0-20.222382-9.083889-20.222382-20.221554 0-11.177574 9.044351-20.221554 20.222382-20.221554l121.336341 0c11.138121 0 20.222382 9.04398 20.222382 20.221554l0 121.330346C953.829019 218.786958 944.744758 227.870848 933.60766 227.870848zM690.933955 955.85804 569.598638 955.85804c-11.178032 0-20.223406-9.083889-20.223406-20.221554 0-11.178597 9.045374-20.222577 20.223406-20.222577L690.933955 915.413909c11.138121 0 20.223406 9.04398 20.223406 20.222577C711.157361 946.774151 702.072076 955.85804 690.933955 955.85804zM690.933955 106.539478 569.598638 106.539478c-11.178032 0-20.223406-9.083889-20.223406-20.221554 0-11.177574 9.045374-20.221554 20.223406-20.221554L690.933955 66.096371c11.138121 0 20.223406 9.04398 20.223406 20.221554C711.157361 97.455589 702.072076 106.539478 690.933955 106.539478zM448.262297 106.539478 326.925956 106.539478c-11.177008 0-20.222382-9.083889-20.222382-20.221554 0-11.177574 9.045374-20.221554 20.222382-20.221554l121.336341 0c11.138121 0 20.222382 9.04398 20.222382 20.221554C468.484679 97.455589 459.399395 106.539478 448.262297 106.539478zM205.589615 955.85804 84.254298 955.85804c-11.178032 0-20.222382-9.083889-20.222382-20.221554L64.031916 814.305117c0-11.177574 9.044351-20.221554 20.222382-20.221554 11.157565 0 20.222382 9.04398 20.222382 20.221554l0 101.109816 101.113958 0c11.157565 0 20.222382 9.04398 20.222382 20.222577C225.813021 946.774151 216.748203 955.85804 205.589615 955.85804zM205.589615 106.539478l-101.113958 0 0 101.108792c0 11.137665-9.064818 20.222577-20.222382 20.222577-11.178032 0-20.222382-9.083889-20.222382-20.222577L64.030892 86.317924c0-11.177574 9.044351-20.221554 20.222382-20.221554l121.336341 0c11.157565 0 20.222382 9.04398 20.222382 20.221554C225.813021 97.455589 216.748203 106.539478 205.589615 106.539478zM84.254298 308.758086c11.157565 0 20.222382 9.045003 20.222382 20.221554l0 121.331369c0 11.137665-9.064818 20.221554-20.222382 20.221554-11.178032 0-20.222382-9.083889-20.222382-20.221554L64.031916 328.97964C64.030892 317.80309 73.076266 308.758086 84.254298 308.758086zM84.254298 551.419801c11.157565 0 20.222382 9.045003 20.222382 20.222577L104.47668 692.972724c0 11.137665-9.064818 20.222577-20.222382 20.222577-11.178032 0-20.222382-9.084912-20.222382-20.222577L64.031916 571.642378C64.030892 560.464805 73.076266 551.419801 84.254298 551.419801zM700.49305 661.534711l-40.998396 40.996716c-7.504212 7.502881-19.748572 7.502881-27.291671 0L516.118465 586.453712 400.035993 702.531428c-7.544122 7.502881-19.788483 7.502881-27.292695 0l-40.998396-40.996716c-7.504212-7.503904-7.504212-19.747763 0-27.290553l116.122382-116.079762L331.744902 402.125567c-7.504212-7.582699-7.504212-19.786649 0-27.330462l40.998396-40.956807c7.504212-7.543813 19.748572-7.543813 27.292695 0l116.082471 116.077715 116.084518-116.077715c7.543099-7.543813 19.787459-7.543813 27.291671 0l40.998396 40.956807c7.504212 7.543813 7.504212 19.747763 0 27.330462L584.369645 518.164397l116.123405 116.079762C707.997262 641.786948 707.997262 654.030807 700.49305 661.534711zM326.925956 915.413909l121.336341 0c11.138121 0 20.222382 9.04398 20.222382 20.222577 0 11.137665-9.084261 20.221554-20.222382 20.221554L326.925956 955.85804c-11.177008 0-20.222382-9.083889-20.222382-20.221554C306.703574 924.45789 315.747925 915.413909 326.925956 915.413909z" p-id="1048"></path>
                    </svg>
                </Tooltip>
            </i>
            <i ref="rote" class="rote" @click="rote">
                <Tooltip placement="top" content="顺时针旋转">
                    <svg class="icon" style="width: 40px; height: 40px;vertical-align: middle;fill: #ff9900;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1408">
                        <path d="M951.629227 461.298248c-11.243065-11.478426-31.018457-11.573593-42.421158-0.393973l-19.681248 19.352767C879.102401 259.036661 699.342294 86.802972 477.064838 86.802972c-227.913826 0-413.357376 185.43127-413.357376 413.357376 0 227.943502 185.445596 413.373749 413.357376 413.373749 121.468492 0 236.415454-53.759391 314.960345-146.978493 3.494591-2.674922 6.330172-5.887081 8.469905-9.510608 0.283456-0.343831 0.599657-0.693802 0.913812-1.038656l2.016937-3.181459-0.661056-0.343831c1.353834-3.560082 1.984191-7.02602 1.984191-10.518564 0-17.229406-13.983479-31.240515-31.209816-31.240515-10.361999 0-20.060895 5.509481-25.698289 14.424524-67.300802 80.872912-165.997662 127.260405-270.775007 127.260405-194.21533 0-352.277252-158.031223-352.277252-352.24553 0-194.19998 158.060899-352.261902 352.277252-352.261902 192.954617 0 350.169241 155.936515 352.21483 348.388688l-35.052331-35.144428c-11.307533-11.385305-31.113625-11.417027-42.420135-0.096191-11.778254 11.701506-11.778254 30.753421-0.063445 42.48358l74.008574 74.194816c5.637394 5.701862 13.227256 8.818853 21.22644 8.818853l0.314155-0.029676 0.787946 0.218988c1.699712 0.441045 3.559059 0.944512 5.636371 0.944512 7.874341 0 15.337313-3.052522 21.00643-8.594749l76.558653-75.331709c5.732561-5.622044 8.943696-13.211906 9.008164-21.227464C960.351889 474.525504 957.266621 466.999087 951.629227 461.298248M675.059238 606.886067l-0.030699-0.124843 0.063445-234.57248c0-28.42233-23.147186-51.537793-51.554166-51.537793L311.508221 320.650951c-28.405957 0-51.522444 23.115464-51.522444 51.537793l0 268.680299c0 28.405957 23.116487 51.55212 51.522444 51.55212l312.030619 0c28.405957 0 51.554166-23.14514 51.554166-51.55212l-0.030699-32.500205 0-1.482771L675.059238 606.886067zM629.458667 374.252753l0 234.209206 0 15.150048 0 15.210423c0 4.408403-3.590781 7.997138-7.999185 7.997138L313.585533 646.819568c-4.408403 0-7.999185-3.589758-7.999185-7.997138L305.586348 374.252753c0-4.425799 3.590781-7.999185 7.999185-7.999185l307.872926 0C625.867886 366.253568 629.458667 369.826953 629.458667 374.252753M586.060251 439.742303c-6.455015 0-12.501732 2.487657-17.006326 6.974855l-83.424015 92.77908L430.235276 500.19207c-4.345981-4.077875-10.077519-6.26775-16.156982-6.26775-7.904017 0-13.951757 2.551102-18.581194 7.212262l-64.623833 86.414115c-8.345062 8.251941-8.345062 23.36822 0.913812 32.659841 4.535293 4.53427 10.519588 7.020904 16.848737 7.020904 6.487761 0 12.43931-2.548032 17.195637-7.336082l52.465932-70.101591L472.686111 588.339666c4.408403 4.122901 10.235109 6.329149 16.818037 6.329149 6.457062 0 12.472056-2.521426 17.005302-7.083326l96.746438-107.59553c4.15667-4.094248 6.643304-10.093892 6.643304-16.502859 0-6.392594-2.488681-12.392238-7.054673-16.895809C598.53333 442.261683 592.391447 439.742303 586.060251 439.742303M402.521075 487.689315c25.446555 0 46.168506-20.707624 46.168506-46.184879 0-25.446555-20.721951-46.153156-46.168506-46.153156-25.445532 0-46.167482 20.705578-46.167482 46.153156C356.353592 466.98169 377.075543 487.689315 402.521075 487.689315" p-id="1409"></path>
                    </svg>
                </Tooltip>
            </i>
            <i ref="rote" class="print" @click="print">
                <Tooltip placement="top" content="打印">
                <svg class="icon" style="width: 40px; height: 40px;vertical-align: middle;fill: #ff9900;overflow: hidden;" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                    viewBox="0 0 488.1 488.1" xml:space="preserve">
                    <g>
                        <path d="M480.3,164.3c0-12.8-5-24.9-14.1-34c-9.1-9.1-21.1-14.1-34-14.1L131,116.4V36l225.9-0.1l-0.2,34.6c0,9.9,8,18,17.9,18.1
                            h0.1c9.9,0,18-8,18-17.9l0.2-36.8c0-18.7-15.2-33.9-34-33.9l-230,0.1c-9.1,0-17.6,3.5-24,10S95,25,95,34.1v82.4H55.8
                            c-12.8,0-24.9,5-34,14.1c-9.1,9.1-14.1,21.2-14.1,34l0.1,173.8c-0.1,12.8,4.9,24.9,14,34c9.1,9.1,21.1,14.1,34,14.1
                            c9.9,0,18-8.1,18-18c0-9.9-8.1-18-18-18c-3.2,0-6.2-1.3-8.5-3.5c-2.3-2.3-3.5-5.3-3.5-8.5l-0.1-173.8c0-6.7,5.4-12.1,12.1-12.1
                            H113l319.2-0.2c3.2,0,6.2,1.3,8.5,3.5c2.3,2.3,3.5,5.3,3.5,8.5l0.1,173.8c0,3.2-1.3,6.3-3.5,8.5c-2.3,2.3-5.3,3.5-8.5,3.5
                            c-9.9,0-18,8.1-18,18c0,9.9,8.1,18,18,18c12.8,0,24.9-5,34-14.1c9.1-9.1,14.1-21.2,14.1-34L480.3,164.3z"/>
                    </g>
                    <g>
                        <path d="M387.6,238.6c-3.4-3.4-8-5.3-12.7-5.3l-262,0.1c-9.9,0-18,8.1-18,18L95,454.2c0,18.7,15.2,33.9,34,33.9l230-0.1
                            c9.1,0,17.6-3.5,24-10c6.4-6.4,9.9-14.9,9.9-24V251.3C392.9,246.5,391,241.9,387.6,238.6z M131.1,452.2L131,269.4l225.9-0.1
                            l0.1,182.8L131.1,452.2z"/>
                    </g>
                </svg>
                </Tooltip>
            </i>
            <img ref='img' :src="picsrc" alt="" :style="`transform: scale(${scale}) rotate(${roted}deg);width:${picW}px;height:${picH}px;top:${picTop}px;left:${picLeft}px`">
        </div>
    </div>
</template>
<script>
export default {
    name: "Picview",
    props: {
        value: {
            type: Boolean,
            default: false
        },
        img: String,
        // width: String,
        // height: String
    },
    data() {
        return {
            picsrc: "",
            picW: "",
            picH: "",
            scale: 1,
            roted: 0,
            picTop: 0,
            picLeft: 0
        };
    },
    methods: {
        print() {
            var strUrl = this.img
            var newstr = '<div><img id="imgTest"'+'src='+strUrl+'></div>'
            var newWindow = window.open('');
            newWindow.document.write(newstr);
            newWindow.document.getElementById("imgTest").onload = function() {
                newWindow.focus();
                newWindow.print();
                newWindow.close();
            };
        },
        isEmpty(s){
            if(s == null || s == "" || s == undefined){
                return true;
            }
            return false;
        },
        closePic(){
            this.$refs.pop.style.display = "none";
                this.$emit("input",false);
                this.$emit("close");
        },
        showPic(){
            if(this.isEmpty(this.img)){
                this.$Message.info("未获取到图片信息");
                return;
            }
            this.picsee(this.img);
        },
        picsee(src) {
            this.picsrc = src;
            this.scale = 1;
            this.roted = 0;
            this.$refs.pop.style.display = "block";
            let img = new Image();
            img.src = src;
            let vm = this;
            img.onload = function() {
                vm.zoom();
                vm.drag();
                vm.countImg();
            };
            window.onresize = function() {
                vm.countImg();
            };
        },
        zoom() {
            let vm = this;
            document.body.onmousewheel = function(event) {
                event = event || window.event;
                if (event.deltaY > 0) {
                    vm.scale = vm.scale > 0.2 ? vm.scale - 0.1 : vm.scale;
                } else {
                    vm.scale += 0.1;
                }
            };
        },
        drag() {
            let oDiv = this.$refs.img;
            let vm = this;
            oDiv.onmousedown = function(en) {
                var ev = ev || event;
                var disX = en.clientX - oDiv.offsetLeft;
                var disY = en.clientY - oDiv.offsetTop;
                if (oDiv.setCapture) {
                    oDiv.setCapture();
                }
                document.onmousemove = function(en) {
                    var ev = ev || event;
                    if (
                        en.clientY > 0 &&
                        en.clientY < vm.$refs.pop.clientHeight &&
                        en.clientX > 0 &&
                        en.clientX < vm.$refs.pop.clientWidth
                    ) {
                        // oDiv.style.top = en.clientY - disY + "px";
                        // oDiv.style.left = en.clientX - disX + "px";
                        vm.picTop = en.clientY - disY;
                        vm.picLeft = en.clientX - disX;
                    }
                };
                document.onmouseup = function() {
                    document.onmousemove = null;
                    if (oDiv.releaseCapture) {
                        oDiv.releaseCapture();
                    }
                };
                return false; //阻止默认行为（如果页面中有文字，则会默认拖动文字），ie8及一下不行
            };
        },
        roteA() {
            this.roted -= 90;
        },
        rote() {
            this.roted += 90;
        },
        close(e) {
            if (
                e.target != this.$refs.img &&
                e.target.contains(this.$refs.rote)
            ) {
                this.$refs.pop.style.display = "none";
                this.$emit("input",false);
                this.$emit("close");
            } else {
                return false;
            }
        },
        countImg() {
            let picW = this.$refs.img.naturalWidth;
            let picH = this.$refs.img.naturalHeight;
            let Width = this.$refs.pop.offsetWidth;
            let Height = this.$refs.pop.offsetHeight;
            if (Width / Height <= picW / picH) {
                this.picW = Width;
                this.picH = `${Number(picH) * Width / Number(picW)}`;
                this.picTop = (Height - this.picH) / 2;
                this.picLeft = 0;
            } else {
                this.picH = Height;
                this.picW = `${Number(picW) * Height / Number(picH)}`;
                this.picTop = 0;
                this.picLeft = (Width - this.picW) / 2;
            }
        }
    },
    watch:{
        value(val){
            if(val)
                this.showPic();
        }
    }
};
</script>
<style  scoped>
.picview-pop {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3);
    user-select: none;
    overflow: hidden;
    z-index: 9998;
}
.picview-pop .mid {
    display: block;
    width: 40px;
    height: 40px;
    cursor: pointer;
    position: absolute;
    right: 50%;
    margin-right: -20px;
    top: 90%;
    z-index: 9999;
}
.picview-pop .roteA {
    
    display: block;
    width: 40px;
    height: 40px;
    cursor: pointer;
    position: absolute;
    right: 50%;
    margin-right: 50px;
    top: 90%;
    z-index: 9999;
}
.picview-pop .rote {
    display: block;
    width: 40px;
    height: 40px;
    cursor: pointer;
    position: absolute;
    right: 50%;
    margin-right: -90px;
    top: 90%;
    z-index: 9999;
}
.picview-pop .print {
    display: block;
    width: 40px;
    height: 40px;
    cursor: pointer;
    position: absolute;
    right: 50%;
    margin-right: -160px;
    top: 90%;
    z-index: 9999;
}
.picview-pop img {
    cursor: move;
    position: absolute;
    background-color: #2d8cf0;
}
</style>

